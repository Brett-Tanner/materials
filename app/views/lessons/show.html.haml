%main.flex.flex-col.text-center
  .flex.p-3
    %div{ class: 'flex-grow flex flex-col gap-3 text-start text-semibold' }
      .flex.gap-2.items-center
        = image_tag icon_path(@lesson), class: 'h-7'
        %h1= @lesson.title
      %h3
        #{split_on_capitals(@lesson.type)}#{" - #{@lesson.subtype.capitalize}" if @lesson.subtype}
      %p= @lesson.goal

      - if @courses.any?
        %h3 Used in the following courses:
        - @courses.each do |c|
          = link_to "#{c.title} on #{@lesson.week(c)} #{@lesson.day(c)}",
                    course_path(c)
      - else
        %h3 Not used in any courses

    - if @lesson.guide.present?
      = link_to file_path(@lesson.guide.blob),
                target: '_blank',
                rel: 'noopener',
                class: 'guide_link border' do
        = image_tag @lesson.guide.preview(:thumb),
                    class: 'guide_image w-full'
        %h3 Download Guide
    - elsif @lesson.instance_of? StandShowSpeak
      = link_to file_path(@lesson.script.blob),
                target: '_blank',
                rel: 'noopener',
                class: 'border' do
        = image_tag @lesson.script.preview(:thumb),
                    class: 'guide_image w-full'
        %h3 Download Script
    - else
      %h3 Guide is being generated, refresh the page in ~10 seconds.

  = render "lessons/#{@lesson.type.pluralize.underscore}/#{@lesson.type.underscore}",
           lesson: @lesson

  .flex.justify-center.gap-3
    = link_to 'Edit',
              edit_lesson_path(@lesson),
              class: 'btn btn-info'

    = link_to 'Delete',
              lesson_path(@lesson),
              data: { turbo_method: 'delete', turbo_confirm: 'Are you sure?' },
              class: 'btn btn-danger'
